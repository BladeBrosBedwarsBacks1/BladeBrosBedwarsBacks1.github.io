<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Track Video Editor</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .editor-container { display: flex; width: 100%; max-width: 1200px; margin-top: 20px; gap: 20px; }
        .media-library { width: 25%; border: 1px solid #ccc; padding: 10px; overflow-y: auto; height: 60vh; }
        .timeline-area { width: 75%; display: flex; flex-direction: column; }
        .preview-player { width: 100%; border: 1px solid #ccc; background-color: #000; }
        .timeline { border: 1px solid #ccc; margin-top: 10px; height: 30vh; overflow-x: auto; white-space: nowrap; }
        .track { border-bottom: 1px solid #ddd; padding: 5px; min-height: 50px; display: flex; align-items: center; gap: 5px; }
        .clip { background-color: #4CAF50; border: 1px solid #388E3C; height: 40px; border-radius: 3px; cursor: grab; position: relative; display: inline-flex; align-items: center; padding: 0 5px; color: white; margin: 2px 0; }
        .media-item { border: 1px solid #eee; padding: 5px; margin-bottom: 5px; cursor: grab; background-color: #f9f9f9; }
        .controls { display: flex; justify-content: center; gap: 10px; margin-top: 20px; width: 100%; max-width: 800px; }
        canvas { width: 100%; height: 100%; }
        input[type="file"] { display: none; }
        .file-upload-label { cursor: pointer; background-color: #007BFF; color: white; padding: 8px 12px; border-radius: 4px; }
        .file-upload-label:hover { background-color: #0056b3; }
        .dragging { opacity: 0.5; }
        .over { border: 2px dashed #007BFF; }
    </style>
</head>
<body>

    <h1>Multi-Track Video Editor</h1>

    <div class="controls">
        <label for="mediaFiles" class="file-upload-label">Upload Media</label>
        <input type="file" id="mediaFiles" accept="video/*,image/*,audio/*" multiple>
        <select id="speedControl" onchange="changeSpeed(this.value)">
            <option value="0.5">0.5x</option>
            <option value="1" selected>1x</option>
            <option value="1.5">1.5x</option>
            <option value="2">2x</option>
        </select>
        <button onclick="clearAll()">Clear All</button>
        <button onclick="saveVideo()">Save (Requires ffmpeg.wasm)</button>
    </div>

    <div class="editor-container">
        <div class="media-library">
            <h3>Media Library</h3>
            <div id="media-library-items"></div>
        </div>
        <div class="timeline-area">
            <canvas id="previewCanvas" class="preview-player"></canvas>
            <div class="timeline">
                <div id="track-video-1" class="track">Video Track 1</div>
                <div id="track-audio-1" class="track">Audio Track 1</div>
            </div>
        </div>
    </div>

    <script>
        const mediaLibraryItems = document.getElementById('media-library-items');
        const mediaFilesInput = document.getElementById('mediaFiles');
        const previewCanvas = document.getElementById('previewCanvas');
        const ctx = previewCanvas.getContext('2d');
        const tracks = {
            'video': document.getElementById('track-video-1'),
            'audio': document.getElementById('track-audio-1'),
        };
        const timeline = document.querySelector('.timeline');

        const mediaFiles = new Map();
        let fileCounter = 0;

        mediaFilesInput.addEventListener('change', (event) => {
            for (const file of event.target.files) {
                const uniqueId = `media-${Date.now()}-${fileCounter++}`;
                mediaFiles.set(uniqueId, file);

                const item = document.createElement('div');
                item.className = 'media-item';
                item.textContent = file.name;
                item.draggable = true;
                item.dataset.id = uniqueId;
                
                mediaLibraryItems.appendChild(item);
            }
        });

        document.body.addEventListener('dragstart', (event) => {
            const target = event.target;
            if (target.classList.contains('media-item') || target.classList.contains('clip')) {
                event.dataTransfer.setData('text/plain', target.dataset.id);
                event.dataTransfer.effectAllowed = target.classList.contains('media-item') ? 'copy' : 'move';
                target.classList.add('dragging');
            }
        });

        document.body.addEventListener('dragend', (event) => {
            const target = event.target;
            if (target.classList.contains('dragging')) {
                target.classList.remove('dragging');
            }
            document.querySelectorAll('.over').forEach(el => el.classList.remove('over'));
        });
        
        timeline.addEventListener('dragover', (event) => {
            event.preventDefault();
            const target = event.target.closest('.track, .clip');
            if (target && target !== event.target.closest('.dragging')) {
                document.querySelectorAll('.over').forEach(el => el.classList.remove('over'));
                target.classList.add('over');
            }
        });
        
        timeline.addEventListener('drop', (event) => {
            event.preventDefault();
            const mediaId = event.dataTransfer.getData('text/plain');
            const draggedElement = document.querySelector(`[data-id="${mediaId}"]`);
            const dropTarget = event.target.closest('.track, .clip');

            if (!draggedElement || !dropTarget) return;

            // Logic for dropping a new item from the library
            if (draggedElement.classList.contains('media-item')) {
                const file = mediaFiles.get(mediaId);
                const track = dropTarget.closest('.track');

                if (track) {
                    const isVideoOrImage = file.type.startsWith('video/') || file.type.startsWith('image/');
                    const isAudio = file.type.startsWith('audio/');

                    if (track.id === 'track-video-1' && isVideoOrImage) {
                        const newClip = createClipElement(file, mediaId);
                        track.appendChild(newClip);
                    } else if (track.id === 'track-audio-1' && isAudio) {
                        const newClip = createClipElement(file, mediaId);
                        track.appendChild(newClip);
                    } else {
                        alert(`Cannot drop a ${file.type.split('/')} file into the ${track.id.split('-')} track.`);
                    }
                }
            } 
            // Logic for reordering existing clips
            else if (draggedElement.classList.contains('clip')) {
                if (dropTarget.classList.contains('clip')) {
                    if (draggedElement.parentNode === dropTarget.parentNode) {
                        dropTarget.parentNode.insertBefore(draggedElement, dropTarget);
                    }
                } else if (dropTarget.classList.contains('track')) {
                    dropTarget.appendChild(draggedElement);
                }
            }
            draggedElement.classList.remove('dragging');
            document.querySelectorAll('.over').forEach(el => el.classList.remove('over'));
        });

        timeline.addEventListener('dblclick', (event) => {
            const clip = event.target.closest('.clip');
            if (clip) {
                clip.remove();
            }
        });

        function createClipElement(file, mediaId) {
            const newClip = document.createElement('div');
            newClip.className = 'clip';
            newClip.textContent = file.name;
            newClip.draggable = true;
            newClip.dataset.id = mediaId;
            return newClip;
        }

        function changeSpeed(speed) {
            // Placeholder for playback speed logic.
        }

        function clearAll() {
            mediaLibraryItems.innerHTML = '';
            tracks['video'].textContent = 'Video Track 1';
            tracks['audio'].textContent = 'Audio Track 1';
            mediaFiles.clear();
            ctx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);
            mediaFilesInput.value = '';
        }

        async function saveVideo() {
            alert('Saving requires a library like ffmpeg.wasm. This is a placeholder.');
        }
    </script>
</body>
</html>
