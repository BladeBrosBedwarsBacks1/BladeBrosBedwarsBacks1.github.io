<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Multi-Media Editor</title><style>
        body {
            font-family: sans-serif;
            background-color: #222;
            color: #fff;
            margin: 0;
            padding: 20px;
            text-align: center;
            user-select: none;
        }
        h1 {
            color: #007bff;
        }

        /* ----- Main Controls ----- */
        .controls-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        #file-upload-label {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #file-upload-label:hover {
            background-color: #0056b3;
        }
        #file-upload {
            display: none;
        }
        #zoom-control {
            width: 150px;
        }
        #zoom-control-label {
            font-size: 0.9em;
            color: #ccc;
        }
        #export-btn {
            padding: 10px 20px;
            background-color: #28a745;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #export-btn:disabled {
            background-color: #555;
            cursor: not-allowed;
        }

        /* ----- Preview Player ----- */
        .preview-player {
            width: 100%;
            max-width: 800px;
            margin: 0 auto 20px;
            position: relative;
            background-color: #000;
            aspect-ratio: 16 / 9;
            overflow: hidden;
        }
        .preview-player #main-preview-video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
            background-color: #000;
        }
        .preview-player #preview-image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            pointer-events: none;
        }

        /* Invisible video for timing */
        #sync-video {
            display: none;
        }

        /* ----- Action Bar ----- */
        .action-bar {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            background-color: #333;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .action-bar button {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            color: #fff;
            font-weight: bold;
        }
        .action-bar .edit-btn { background-color: #007bff; }
        .action-bar .delete-btn { background-color: #dc3545; }
        .action-bar button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }

        /* ----- Timeline ----- */
        .timeline-container {
            width: 100%;
            overflow-x: auto;
            background: #1a1a1a;
            padding: 10px;
            border-radius: 8px;
            position: relative;
        }
        .timeline-track {
            display: flex;
            min-height: 100px;
            border-top: 2px solid #444;
            border-bottom: 2px solid #444;
            position: relative;
            padding: 10px 0;
            gap: 5px;
            align-items: center;
            width: fit-content;
            min-width: 100%;
            box-sizing: border-box;
            margin-bottom: 10px;
        }
        .timeline-track:first-of-type { border-top: none; }
        #timeline-padding {
            flex-grow: 1;
            min-width: 500px;
        }
        #timeline-indicator {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 2px;
            background-color: red;
            cursor: ew-resize;
            z-index: 10;
            transform: translateX(0);
        }
        #indicator-handle {
            position: absolute;
            top: -10px;
            left: -8px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 10px solid red;
            cursor: ew-resize;
        }

        /* ----- Clips ----- */
        .clip {
            position: relative;
            height: 80px;
            background-color: #4CAF50;
            border: 2px solid #666;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
            cursor: pointer;
            box-sizing: border-box;
            white-space: nowrap;
            overflow: hidden;
            transition: border-color 0.3s;
            touch-action: none;
        }
        .clip.active {
            border-color: #007bff;
            cursor: grab;
        }

        /* Clip Preview */
        .clip-preview {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .clip-preview img, .clip-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .clip-preview .audio-icon {
            font-size: 3em;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
</style></head><body><div class="header"><h1>Multi-Media Editor</h1></div><div class="controls-container"><label for="file-upload" id="file-upload-label">Select Media Files</label><input type="file" id="file-upload" accept="video/*,audio/*,image/*" multiple><button id="export-btn" disabled>Export Video</button><div><label for="zoom-control" id="zoom-control-label">Zoom: 1x</label><input type="range" id="zoom-control" min="10" max="200" value="50"></div></div><div class="action-bar"><button class="edit-btn" id="edit-clip-btn" disabled>Edit Clip</button><button class="delete-btn" id="delete-clip-btn" disabled>Delete Clip</button></div><div class="preview-player"><video id="main-preview-video" muted playsinline></video><video id="sync-video" muted playsinline></video><img id="preview-image-overlay" style="display: none;"></div><div class="timeline-container"><div id="timeline-indicator"><div id="indicator-handle"></div></div></div><script>
        document.getElementById('file-upload').addEventListener('change', handleFileSelect);
        document.getElementById('zoom-control').addEventListener('input', handleZoom);
        document.getElementById('export-btn').addEventListener('click', handleClickExport);
        document.getElementById('edit-clip-btn').addEventListener('click', handleEditClip);
        document.getElementById('delete-clip-btn').addEventListener('click', handleDeleteClip);
        
        const timelineContainer = document.querySelector('.timeline-container');
        const indicator = document.getElementById('timeline-indicator');
        const mainPreviewVideo = document.getElementById('main-preview-video');
        const syncVideo = document.getElementById('sync-video');
        const previewImageOverlay = document.getElementById('preview-image-overlay');
        const zoomControl = document.getElementById('zoom-control');
        const zoomLabel = document.getElementById('zoom-control-label');
        const editClipBtn = document.getElementById('edit-clip-btn');
        const deleteClipBtn = document.getElementById('delete-clip-btn');
        
        let activeClipElement = null;

        const state = {
            currentTime: 0,
            widthPerSecond: 50,
            tracks: [[]],
            isDraggingIndicator: false,
            audioPlayer: new Audio(),
            totalDuration: 0
        };

        function createNewTrack() {
            const trackIndex = state.tracks.length;
            const trackElement = document.createElement('div');
            trackElement.className = 'timeline-track';
            trackElement.id = `track-${trackIndex}`;
            timelineContainer.appendChild(trackElement);
            state.tracks.push([]);
            return trackElement;
        }

        function getFirstAvailableTrack() {
            let availableTrack = null;
            for(let i = 0; i < state.tracks.length; i++) {
                if (state.tracks[i].length === 0) {
                    return document.getElementById(`track-${i}`);
                }
            }
            return createNewTrack();
        }

        function appendClipToTrack(clipElement) {
            const targetTrack = getFirstAvailableTrack();
            const trackIndex = parseInt(targetTrack.id.split('-')[1]);
            targetTrack.appendChild(clipElement);
            return trackIndex;
        }

        function updateTimelineAndState() {
            state.totalDuration = state.tracks.reduce((maxDuration, track) => {
                const trackDuration = track.reduce((sum, clip) => sum + clip.duration, 0);
                return Math.max(maxDuration, trackDuration);
            }, 0);
            updateClipWidths();
            updateTimelinePadding();
            updateExportButtonState();
        }

        function updateClipWidths() {
            const widthPerSecond = state.widthPerSecond;
            let totalTimelineWidth = 0;
            timelineContainer.querySelectorAll('.timeline-track').forEach((trackElement, trackIndex) => {
                let trackWidth = 0;
                trackElement.querySelectorAll('.clip').forEach(clip => {
                    const duration = parseFloat(clip.dataset.duration);
                    if (duration) {
                        const width = duration * widthPerSecond;
                        clip.style.width = `${width}px`;
                        trackWidth += width + 5;
                    }
                });
                trackElement.style.minWidth = `${trackWidth}px`;
                totalTimelineWidth = Math.max(totalTimelineWidth, trackWidth);
            });

            timelineContainer.querySelectorAll('.timeline-track').forEach(trackEl => {
                trackEl.style.minWidth = `${totalTimelineWidth}px`;
            });
            const indicatorX = state.currentTime * state.widthPerSecond;
            indicator.style.transform = `translateX(${indicatorX}px)`;
        }

        function updateTimelinePadding() {
            let paddingElement = document.getElementById('timeline-padding');
            if (!paddingElement) {
                const trackElement = document.getElementById('track-0');
                if (trackElement) {
                    paddingElement = document.createElement('div');
                    paddingElement.id = 'timeline-padding';
                    paddingElement.style.flexGrow = 1;
                    trackElement.appendChild(paddingElement);
                }
            }
            if (paddingElement) {
                const paddingWidth = timelineContainer.offsetWidth * 0.75;
                paddingElement.style.minWidth = `${paddingWidth}px`;
            }
        }

        function handleZoom(event) {
            state.widthPerSecond = parseInt(event.target.value);
            zoomLabel.textContent = `Zoom: ${(state.widthPerSecond / 50).toFixed(1)}x`;
            updateClipWidths();
        }

        function updateActionButtons() {
            const hasClips = state.tracks.some(track => track.length > 0);
            const hasActiveClip = activeClipElement !== null;
            editClipBtn.disabled = !hasActiveClip;
            deleteClipBtn.disabled = !hasActiveClip;
            document.getElementById('export-btn').disabled = !hasClips;
        }

        function updateExportButtonState() {
            const hasClips = state.tracks.some(track => track.length > 0);
            document.getElementById('export-btn').disabled = !hasClips;
        }

        function handleFileSelect(event) {
            const files = event.target.files;
            
            for (const file of files) {
                const mimeType = file.type;
                const fileURL = URL.createObjectURL(file);
                
                const clipElement = document.createElement('div');
                clipElement.className = 'clip';
                clipElement.dataset.fileType = mimeType;
                clipElement.dataset.fileUrl = fileURL;
                
                clipElement.addEventListener('click', (e) => {
                    if (activeClipElement) {
                        activeClipElement.classList.remove('active');
                    }
                    activeClipElement = clipElement;
                    activeClipElement.classList.add('active');
                    updateActionButtons();
                    const trackElement = clipElement.parentElement;
                    const trackIndex = parseInt(trackElement.id.split('-')[1]);
                    const clipIndex = Array.from(trackElement.querySelectorAll('.clip')).indexOf(clipElement);
                    const clipStartTime = state.tracks[trackIndex].slice(0, clipIndex).reduce((sum, clip) => sum + clip.duration, 0);
                    const clipPosition = clipStartTime * state.widthPerSecond;
                    indicator.style.transform = `translateX(${clipPosition}px)`;
                    state.currentTime = clipStartTime;
                    syncVideo.currentTime = state.currentTime;
                    previewPlayer.update(state.currentTime);
                });

                const previewElement = document.createElement('div');
                previewElement.className = 'clip-preview';
                clipElement.appendChild(previewElement);
                
                const trackIndex = appendClipToTrack(clipElement);

                if (mimeType.startsWith('video/')) {
                    const videoPreview = document.createElement('video');
                    videoPreview.preload = 'metadata';
                    videoPreview.controls = false;
                    videoPreview.src = fileURL;
                    previewElement.appendChild(videoPreview);
                    
                    videoPreview.onloadedmetadata = () => {
                        const duration = videoPreview.duration;
                        clipElement.dataset.duration = duration;
                        state.tracks[trackIndex].push({ type: 'video', duration, fileUrl: fileURL, element: clipElement });
                        updateTimelineAndState();
                    };
                } else if (mimeType.startsWith('image/')) {
                    const imagePreview = document.createElement('img');
                    imagePreview.src = fileURL;
                    previewElement.appendChild(imagePreview);
                    clipElement.dataset.duration = 5;
                    state.tracks[trackIndex].push({ type: 'image', duration: 5, fileUrl: fileURL, element: clipElement });
                    updateTimelineAndState();
                } else if (mimeType.startsWith('audio/')) {
                    console.log("Processing audio file:", file.name);
                    const audioIcon = document.createElement('div');
                    audioIcon.className = 'audio-icon';
                    audioIcon.innerHTML = 'ðŸŽµ';
                    previewElement.appendChild(audioIcon);
                    
                    const audio = new Audio(fileURL);
                    audio.preload = 'metadata';
                    audio.onloadedmetadata = () => {
                        const duration = audio.duration;
                        clipElement.dataset.duration = duration;
                        state.tracks[trackIndex].push({ type: 'audio', duration, fileUrl: fileURL, element: clipElement });
                        updateTimelineAndState();
                        console.log("Audio metadata loaded successfully.");
                    };
                    audio.onerror = (e) => {
                        console.error("Error loading audio metadata:", e);
                    };
                }
            }
        }
        
        // --- Indicator drag functionality ---
        function handleDragIndicator(e) {
            if (state.isDraggingIndicator) {
                const timelineRect = timelineContainer.getBoundingClientRect();
                const clientX = e.touches ? e.touches.clientX : e.clientX;
                const newX = clientX - timelineRect.left + timelineContainer.scrollLeft;
                indicator.style.transform = `translateX(${Math.max(0, newX)}px)`;
                state.currentTime = Math.max(0, newX / state.widthPerSecond);
                syncVideo.currentTime = state.currentTime;
                // Don't update the preview on every mousemove, for performance
            }
        }

        indicator.addEventListener('mousedown', (e) => {
            e.stopPropagation();
            state.isDraggingIndicator = true;
            document.body.style.cursor = 'ew-resize';
            syncVideo.pause();
        });
        indicator.addEventListener('touchstart', (e) => {
            e.stopPropagation();
            e.preventDefault();
            state.isDraggingIndicator = true;
            document.body.style.cursor = 'ew-resize';
            syncVideo.pause();
        });

        document.addEventListener('mouseup', () => {
            if (state.isDraggingIndicator) {
                state.isDraggingIndicator = false;
                document.body.style.cursor = 'default';
                previewPlayer.update(state.currentTime); // Force update after drag
                syncVideo.play();
            }
        });
        document.addEventListener('touchend', () => {
            if (state.isDraggingIndicator) {
                state.isDraggingIndicator = false;
                document.body.style.cursor = 'default';
                previewPlayer.update(state.currentTime); // Force update after drag
                syncVideo.play();
            }
        });

        document.addEventListener('mousemove', handleDragIndicator);
        document.addEventListener('touchmove', handleDragIndicator);

        timelineContainer.addEventListener('click', (e) => {
            if (e.target.closest('.clip')) return;
            const timelineRect = timelineContainer.getBoundingClientRect();
            const clickX = e.clientX - timelineRect.left + timelineContainer.scrollLeft;
            indicator.style.transform = `translateX(${Math.max(0, clickX)}px)`;
            state.currentTime = Math.max(0, clickX / state.widthPerSecond);
            syncVideo.currentTime = state.currentTime;
            syncVideo.play();
            previewPlayer.update(state.currentTime);
        });

        document.addEventListener('click', (e) => {
            if (activeClipElement && !e.target.closest('.clip') && !e.target.closest('.action-bar')) {
                activeClipElement.classList.remove('active');
                activeClipElement = null;
                updateActionButtons();
            }
        });

        // --- Action Bar Functions ---
        function handleEditClip() {
            if (activeClipElement) {
                const fileType = activeClipElement.dataset.fileType;
                alert(`Editing ${fileType} clip: ${activeClipElement.dataset.fileUrl.split('/').pop()}`);
            }
        }

        function handleDeleteClip() {
            if (activeClipElement) {
                const fileURL = activeClipElement.dataset.fileUrl;
                const trackElement = activeClipElement.parentElement;
                const trackIndex = parseInt(trackElement.id.split('-')[1]);
                if (confirm(`Are you sure you want to delete this clip?`)) {
                    activeClipElement.remove();
                    URL.revokeObjectURL(fileURL);
                    state.tracks[trackIndex] = state.tracks[trackIndex].filter(m => m.fileUrl !== fileURL);
                    activeClipElement = null;
                    updateTimelineAndState();
                    updateActionButtons();
                }
            }
        }

        // --- Export functionality (placeholder) ---
        function handleClickExport() {
            alert('Export functionality is not yet implemented. This would trigger a complex rendering process.');
            console.log('Exporting media...', state.tracks);
        }

        // Initial setup
        createNewTrack();
        updateTimelineAndState();
</script></body></html>
